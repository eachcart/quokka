local c=component local inv=c.invoke local d,o={},{} local function f(m)local u={"B","KiB","MiB","GiB"}local n=1 while m>1024 and u[n+1]do n=n+1 m=m/1024 end return string.format("%.2f",m).." "..u[n]end local function g(a)local s=inv(a,"readSector",1)for j=1,#s do if s:sub(j,j)=="\0"then s=s:sub(1,j-1)break end end return s end local p=c.list("eeprom")() computer.getBootAddress=function()return inv(p,"getData")end computer.setBootAddress=function(a)return inv(p,"setData",a)end local function h(a)if c.type(a)=="drive"then local k=load(g(a))return not not k elseif c.type(a)=="filesystem"then return (inv(a,"exists","OS.lua")and not inv(a,"isDirectory","OS.lua"))or((not inv(a,"exists","OS.lua"))and inv(a,"exists","init.lua")and not inv(a,"isDirectory","init.lua"))end return false end for a in c.list("drive")do if h(a)then d[#d+1]=a end end for a in c.list("filesystem")do if h(a)then o[#o+1]=a end end local s,t=c.list("screen")(),c.list("gpu")() inv(t,"bind",s) inv(t,"setResolution",inv(t,"maxResolution")) local w,h=inv(t,"getResolution") local function clear()inv(t,"setBackground",0xBFBFBF) inv(t,"setForeground",0x000000) inv(t,"fill",1,1,w,h," ")end local function center(text,y)inv(t,"set",(w-#text)//2,y,text)end local function border(x,y,w,h) inv(t,"set",x,y,"+"..string.rep("-",w-2).."+") for i=1,h-2 do inv(t,"set",x,y+i,"|  "..string.rep(" ",w-6).."  |") end inv(t,"set",x,y+h-1,"+"..string.rep("-",w-2).."+") end local entries={}for _,v in pairs(d)do entries[#entries+1]=v end for _,v in pairs(o)do entries[#entries+1]=v end local bootAddr=computer.getBootAddress() local selected=1 for i,v in ipairs(entries)do if v==bootAddr then selected=i break end end local function draw()clear()center("Quokka",2)center("Use ↑/↓ to choose, Enter to boot",3)center("Memory: "..f(computer.totalMemory()),4) local bw,bh=math.min(w-4,52),math.max(#entries+5,9) local bx,by=(w-bw)//2,(h-bh)//2+2 border(bx,by,bw,bh) inv(t,"setForeground",0x000000) inv(t,"setBackground",0xBFBFBF) inv(t,"set",(w-4)//2,by+1,"    ") for i,v in ipairs(entries)do local label=inv(v,"getLabel")or"No Label" local text=string.format("[%d] %s (%s)",i,v:sub(1,8),label) if i==selected then inv(t,"setForeground",0xFFFFFF) inv(t,"setBackground",0x000000) else inv(t,"setForeground",0x000000) inv(t,"setBackground",0xBFBFBF) end inv(t,"set",(w-#text)//2,by+2+i,text) end inv(t,"setForeground",0x000000) inv(t,"setBackground",0xBFBFBF) inv(t,"set",(w-4)//2,by+bh-2,"    ") end local function boot(a)clear()center((inv(a,"getLabel")or"Unknown"),h//2)computer.setBootAddress(a)if c.type(a)=="filesystem"then local p=inv(a,"exists","/OS.lua")and"/OS.lua"or"/init.lua"local f,e=inv(a,"open",p)if not f then error(e)end local d=""repeat local c=inv(a,"read",f,math.huge)d=d..(c or"")until not c load(d)()elseif c.type(a)=="drive"then load(g(a))()end clear()end if #entries==0 then error("No bootable media found!")end if #entries==1 then boot(entries[1])end draw()while true do local ev,_,_,key=computer.pullSignal()if ev=="key_down"then if key==200 then selected=selected>1 and selected-1 or#entries elseif key==208 then selected=selected<#entries and selected+1 or 1 elseif key==28 then boot(entries[selected])end draw()elseif ev=="touch"then local _,_,_,y=computer.pullSignal()local offset=y-((h-(#entries+5))//2+2)if entries[offset]then if selected==offset then boot(entries[selected])else selected=offset end draw()end end end
